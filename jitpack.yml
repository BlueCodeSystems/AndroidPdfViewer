jdk:
  - openjdk17

before_install:
  # Ensure Android SDK paths are set for Gradle/AGP
  - echo "sdk.dir=$ANDROID_HOME" > local.properties
  # Accept licenses non-interactively
  - yes | ${ANDROID_HOME}/cmdline-tools/latest/bin/sdkmanager --licenses > /dev/null || true
  # Install required SDK components
  - ${ANDROID_HOME}/cmdline-tools/latest/bin/sdkmanager "platforms;android-35" "build-tools;35.0.0" "ndk;26.2.11394342"

install:
  # Derive owner from origin and set GROUP accordingly
  - ORIGIN=$(git config --get remote.origin.url)
  - OWNER=$(echo "$ORIGIN" | sed -E 's#.*[:/ ]([^/]+)/[^/]+(\.git)?$#\1#')
  - OWNER_LC=$(echo "$OWNER" | tr '[:upper:]' '[:lower:]')
  - if echo "$OWNER_LC" | grep -qi 'bluecode'; then GROUP=bluecode; else GROUP=com.github.${OWNER}; fi
  - echo "Origin=$ORIGIN Owner=$OWNER Using GROUP=${GROUP} VERSION=${VERSION} (skipSigning)"
  - ./gradlew --no-daemon -x test -x lint -PskipSigning=true -PGROUP=${GROUP} -PVERSION_NAME=${VERSION} :android-pdf-viewer:publishToMavenLocal
  # Verify artifact installed to local Maven
  - echo "Listing ~/.m2/repository/${GROUP}/AndroidPdfViewer/${VERSION} (if present)" && ls -la ~/.m2/repository/${GROUP}/AndroidPdfViewer/${VERSION} || true
